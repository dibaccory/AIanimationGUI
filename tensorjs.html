<!-- Jonathon Rice jo023439, COP 4720 -->
<!DOCTYPE html>
<html>
	<head>
		<meta charset=utf-8>
		<title>Neural Network Builder</title>
<!-- 		<style>
			body { margin: 0; }
			canvas { width: 100%; height: 100% }
		</style> -->
		<script src="https://threejs.org/build/three.js"></script>
		<script src="https://threejs.org/examples/js/controls/OrbitControls.js"></script>
		<script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@0.13.0"> </script>
		<script>

			function mainFunction()
          	{
				var model;

					model = tf.sequential();

					model.add(tf.layers.conv2d({
						inputShape: [28, 28, 1],
						kernelSize: 5,
						filters: 8,
						strides: 1,
						activation: 'relu',
						kernelInitializer: 'VarianceScaling'
					}));

					model.add(tf.layers.maxPooling2d({
						poolSize: [2,2],
						strides: [2,2]
					}));

					model.add(tf.layers.conv2d({
						kernelSize: 5,
						filters: 16,
						strides: 1,
						activation: 'relu',
						kernelInitializer: 'VarianceScaling'
					}));

					model.add(tf.layers.maxPooling2d({
						poolSize: [2,2],
						strides: [2,2]
					}));

					model.add(tf.layers.flatten());
					model.add(tf.layers.dense({
						units: 10,
						kernelInitializer: 'VarianceScaling',
						activation: 'softmax'
					}))

					// createLogEntry('Layers created');
					// model.summary();
					// Grabs 1st layer
					console.log(model.getLayer('', 0));

					// Layer weights, kernel in this case
					// let layer1 = model.layers[0].getWeights()[0].dataSync()
					// console.log(layer1)

					// grabs output 1 layer at a time
					const input = tf.ones([1, 28, 28, 1]);
					const output = model.getLayer('', 0).apply(input);

					// .dataSync() pull from gpu and give 1D js array
					// Converts back to original shape
					// console.log(output.dataSync());
					console.log(output.shape);
					var l = output.shape[1];
					var m = output.shape[2];
					var n = output.shape[3];

					var arr =  Array.prototype.slice.call(output.dataSync());
					var newArr = [];
					var newArr2 = [];
					var newArr3 = [];

					while(arr.length) 
					{
						newArr.push(arr.splice(0,n));
					}
					while(newArr.length) 
					{
						newArr2.push(newArr.splice(0,m));
					}

					while(newArr2.length) 
					{
						newArr3.push(newArr2.splice(0,l));
					}
					console.log(newArr3);


					// const output2 = model.getLayer('', 1).apply(output);
					// console.log(output2.dataSync());
				// }
			}
		</script>
	</head>
	<body onload="mainFunction();">
	</body>
</html>